"use strict";var __extends=this&&this.__extends||function(){var s=function(e,r){return(s=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,r){e.__proto__=r}:function(e,r){for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}))(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function t(){this.constructor=e}s(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}(),__decorate=this&&this.__decorate||function(e,r,t,s){var n,u=arguments.length,a=u<3?r:null===s?s=Object.getOwnPropertyDescriptor(r,t):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,r,t,s);else for(var i=e.length-1;0<=i;i--)(n=e[i])&&(a=(u<3?n(a):3<u?n(r,t,a):n(r,t))||a);return 3<u&&a&&Object.defineProperty(r,t,a),a},__awaiter=this&&this.__awaiter||function(e,a,i,o){return new(i=i||Promise)(function(t,r){function s(e){try{u(o.next(e))}catch(e){r(e)}}function n(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){var r;e.done?t(e.value):((r=e.value)instanceof i?r:new i(function(e){e(r)})).then(s,n)}u((o=o.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(s,n){var u,a,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},d={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d;function e(t){return function(e){var r=[t,e];if(u)throw new TypeError("Generator is already executing.");for(;o=d&&r[d=0]?0:o;)try{if(u=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,(r=i?[2&r[0],i.value]:r)[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3]))o.label=r[1];else if(6===r[0]&&o.label<i[1])o.label=i[1],i=r;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(r)}}r=n.call(s,o)}catch(e){r=[6,e],a=0}finally{u=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}}},typeorm_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.SdUsersRepository=void 0,require("typeorm")),SdUsers_entity_1=require("../entities/SdUsers.entity"),SdUsersRepository=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.getWhereRs=function(f){return __awaiter(this,void 0,void 0,function(){var r,t,s,n,u,a,i,o,d,_,l,c,p,h;return __generator(this,function(e){switch(e.label){case 0:return r=f.user_id,t=f.profile_id,s=f.keyword,n=f.gender,u=f.idcard,a=f.network_id,f.level,f.infomation_agree_status,f.birthday,f.last_sign_in,f.online_status,i=f.status,o=f.start,d=f.end,_=f.order,l=f.pages,c=f.sizepsge,0==(p=f.isCount)?(console.log("rows filter ",f),console.log("data keyword ",s),console.log("rows isCount ",p)):(console.log("data filter ",f),console.log("data keyword ",s),console.log("data isCount ",p)),h=this.createQueryBuilder("u"),1==p?h.select(["u.user_id AS user_id"]):(h.distinctOn(["u.user_id AS user_id"]),h.select(["u.user_id AS user_id","u.profile_id AS profile_id","u.first_name AS first_name","u.last_name AS last_name","u.fullname AS fullname","u.nickname AS nickname","u.username AS username","u.email AS email","u.level AS level","u.status AS status","u.network_id AS network_id","u.avatar AS avatar","u.idcard AS idcard","u.remark AS remark","u.infomation_agree_status AS infomation_agree_status","u.gender AS gender","u.birthday AS birthday","u.date AS date","u.last_sign_in AS last_sign_in","u.online_status AS online_status","u.mesage AS mesage","u.network_type AS network_type"])),h.leftJoin("sd_user_roles","r","r.user_id = u.user_id"),h.leftJoin("sd_users_pdpa_allow","p","p.user_id = u.user_id"),h.where("1=1"),null!=i&&h.andWhere("u.status= :status",{status:i}),null!=r&&h.andWhere("u.user_id= :user_id",{user_id:r}),null!=t&&h.andWhere("co.profile_id= :profile_id",{profile_id:t}),null!=u&&h.andWhere("co.idcard= :idcard",{idcard:u}),null!=a&&h.andWhere("co.network_id= :network_id",{network_id:a}),null!=n&&h.andWhere("co.gender= :gender",{gender:n}),null!=s&&h.andWhere("u.first_name like :keyword",{keyword:s?"%".concat(s,"%"):"%"}),null!=o&&null!=d&&h.andWhere("u.last_sign_in BETWEEN '"+o+"' AND '"+d+"'"),1!=p&&(h.limit(c),h.offset(c*(l-1))),h.groupBy("u.user_id"),"desc"==_?h.orderBy("u.user_id","DESC"):(h.groupBy("u.user_id"),h.orderBy("u.user_id","ASC")),h.printSql(),h.maxExecutionTime(1e3),console.log("SdUser.repository  query-> ",h),[4,h.getRawMany()];case 1:return[2,e.sent()]}})})},r.prototype.getWhereChk=function(s){return __awaiter(this,void 0,void 0,function(){var r,t;return __generator(this,function(e){switch(e.label){case 0:return r=s.user_id,(t=this.createQueryBuilder("u")).select(["u.user_id AS user_id"]),t.where("1=1"),t.andWhere("u.user_id= :user_id",{user_id:r}),t.orderBy("u.user_id","ASC"),console.log("query-> ",t),[4,t.getRawMany()];case 1:return[2,e.sent()]}})})},r.prototype.getWhereChkLogin=function(n){return __awaiter(this,void 0,void 0,function(){var r,t,s;return __generator(this,function(e){switch(e.label){case 0:return r=n.username,t=n.password,(s=this.createQueryBuilder("u")).distinctOn(["u.user_id AS user_id"]),s.select(["u.user_id AS user_id"]),s.where("1=1"),s.andWhere("u.username= :username",{username:r}),s.andWhere("u.password= :password",{password:t}),s.andWhere("u.status=1"),s.groupBy("u.user_id"),s.orderBy("u.user_id","ASC"),s.printSql(),s.maxExecutionTime(1e3),console.log("query-> ",s),[4,s.getRawMany()];case 1:return[2,e.sent()]}})})},r.prototype.ChkLastID=function(e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(e){switch(e.label){case 0:return(r=this.createQueryBuilder("u")).select(["u.user_id AS user_id"]),r.limit(1),r.orderBy("u.user_id","DESC"),console.log("query-> ",r),[4,r.getRawMany()];case 1:return[2,e.sent()]}})})},r.prototype.ChkLogin=function(n){return __awaiter(this,void 0,void 0,function(){var r,t,s;return __generator(this,function(e){switch(e.label){case 0:return r=n.username,t=n.password,(s=this.createQueryBuilder("u")).select(["u.user_id AS user_id"]),s.where("1=1"),s.andWhere("u.username= :username",{username:r}),s.andWhere("u.password= :password",{password:t}),s.andWhere("u.status=1"),s.groupBy("u.user_id"),s.orderBy("u.user_id","ASC"),console.log("query-> ",s),[4,s.getRawMany()];case 1:return[2,e.sent()]}})})},r.prototype.Chknetwork_id=function(s){return __awaiter(this,void 0,void 0,function(){var r,t;return __generator(this,function(e){switch(e.label){case 0:return r=s.network_id,(t=this.createQueryBuilder("u")).select(["u.user_id AS user_id"]),t.where("1=1"),t.andWhere("u.network_id= :network_id",{network_id:r}),t.orderBy("u.user_id","ASC"),console.log("query-> ",t),[4,t.getRawMany()];case 1:return[2,e.sent()]}})})},r.prototype.Chkusername=function(s){return __awaiter(this,void 0,void 0,function(){var r,t;return __generator(this,function(e){switch(e.label){case 0:return r=s.username,(t=this.createQueryBuilder("u")).select(["u.user_id AS user_id"]),t.where("1=1"),t.andWhere("u.username= :username",{username:r}),t.orderBy("u.user_id","ASC"),console.log("query-> ",t),[4,t.getRawMany()];case 1:return[2,e.sent()]}})})},r.prototype.ChkEmail=function(s){return __awaiter(this,void 0,void 0,function(){var r,t;return __generator(this,function(e){switch(e.label){case 0:return r=s.email,console.log("data ChkEmail input ",s),(t=this.createQueryBuilder("u")).select(["u.user_id AS user_id"]),t.where("1=1"),t.andWhere("u.email= :email",{email:r}),t.orderBy("u.user_id","ASC"),console.log("query-> ",t),[4,t.getRawMany()];case 1:return[2,e.sent()]}})})},r.prototype.getWhereChkLoginStatus=function(n){return __awaiter(this,void 0,void 0,function(){var r,t,s;return __generator(this,function(e){switch(e.label){case 0:return r=n.username,t=n.password,(s=this.createQueryBuilder("u")).select(["u.user_id AS user_id"]),s.where("1=1"),s.andWhere("u.username= :username",{username:r}),s.andWhere("u.password= :password",{password:t}),s.andWhere("u.status= :status",{status:1}),s.groupBy("u.user_id"),s.orderBy("u.user_id","ASC"),console.log("query-> ",s),[4,s.getRawMany()];case 1:return[2,e.sent()]}})})},r.prototype.insertData=function(b){return __awaiter(this,void 0,void 0,function(){var r,t,s,n,u,a,i,o,d,_,l,c,p,h,f,y,w,m,g,v,S,k,A;return __generator(this,function(e){switch(e.label){case 0:return r=b.profile_id,t=b.first_name,s=b.last_name,n=b.fullname,u=b.nickname,a=b.username,i=b.password,o=b.email,d=b.level,_=b.status,l=b.network_id,c=b.avatar,p=b.idcard,h=b.remark,f=b.infomation_agree_status,y=b.gender,w=b.birthday,m=b.date,g=b.last_sign_in,v=b.online_status,S=b.mesage,k=b.update_date,A=b.network_type,[4,this.createQueryBuilder().insert().into("sd_users").values({profile_id:r,first_name:t,last_name:s,fullname:n,nickname:u,username:a,password:i,email:o,level:d,status:_,network_id:l,avatar:c,idcard:p,remark:h,infomation_agree_status:f,gender:y,birthday:w,date:m,last_sign_in:g,online_status:v,mesage:S,update_date:k,network_type:A}).execute()];case 1:return[2,e.sent()]}})})},r.prototype.updateData=function(e){var r=e.user_id,e={profile_id:e.profile_id,first_name:e.first_name,last_name:e.last_name,fullname:e.fullname,nickname:e.nickname,username:e.username,password:e.password,email:e.email,level:e.level,status:e.status,network_id:e.network_id,avatar:e.avatar,idcard:e.idcard,remark:e.remark,infomation_agree_status:e.infomation_agree_status,gender:e.gender,birthday:e.birthday,date:e.date,last_sign_in:e.last_sign_in,online_status:e.online_status,mesage:e.mesage,update_date:e.update_date};return this.createQueryBuilder("sd_users").update("sd_users").set(e).andWhere("user_id = :user_id",{user_id:r}).execute()},r.prototype.updateprofileid=function(e){var r=e.user_id,e={profile_id:e.profile_id};return this.createQueryBuilder("sd_users").update("sd_users").set(e).andWhere("user_id = :user_id",{user_id:r}).execute()},r.prototype.updatePassword=function(e){var r=e.user_id,e={password:e.password,update_date:e.update_date};return this.createQueryBuilder("sd_users").update("sd_users").set(e).andWhere("user_id = :user_id",{user_id:r}).execute()},r.prototype.updateDatastatus=function(e){var r=e.user_id,t=(e.profile_id,e.create_date,e.update_date),t={status:e.status,update_date:t};return console.warn("input ",e),console.warn("values ",t),this.createQueryBuilder("sd_users").update("sd_users").set(t).where("user_id = :user_id",{user_id:r}).execute()},r.prototype.updateDataLogin=function(e){var r=e.user_id,t=e.last_sign_in,t=(e.status,{last_sign_in:t});return console.warn("input ",e),console.warn("values ",t),this.createQueryBuilder("sd_users").update("sd_users").set(t).where("user_id = :user_id",{user_id:r}).execute()},r.prototype.deleteData=function(e){var r=e.user_id;e.profile_id;return this.createQueryBuilder("sd_users").delete().from("sd_users").where("user_id = :user_id",{user_id:r}).execute()},__decorate([(0,typeorm_1.EntityRepository)(SdUsers_entity_1.SdUsers)],r)}(typeorm_1.Repository);exports.SdUsersRepository=SdUsersRepository;