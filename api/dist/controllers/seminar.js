"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,s)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__awaiter=this&&this.__awaiter||function(e,o,i,l){return new(i=i||Promise)(function(r,t){function a(e){try{n(l.next(e))}catch(e){t(e)}}function s(e){try{n(l.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}n((l=l.apply(e,o||[])).next())})},__generator=this&&this.__generator||function(a,s){var n,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},d={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d;function e(r){return function(e){var t=[r,e];if(n)throw new TypeError("Generator is already executing.");for(;l=d&&t[d=0]?0:l;)try{if(n=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,(t=i?[2&t[0],i.value]:t)[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3]))l.label=t[1];else if(6===t[0]&&l.label<i[1])l.label=i[1],i=t;else{if(!(i&&l.label<i[2])){i[2]&&l.ops.pop(),l.trys.pop();continue}l.label=i[2],l.ops.push(t)}}t=s.call(a,l)}catch(e){t=[6,e],o=0}finally{n=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},path=(Object.defineProperty(exports,"__esModule",{value:!0}),__importStar(require("path"))),crypto=__importStar(require("crypto")),user_model_1=require("../models/user_model"),file_1=require("../models/file"),sd_users_narrator_model_1=require("../models/sd_users_narrator_model"),sd_users_seminar_model_1=require("../models/sd_users_seminar_model"),seminar_detail_model_1=require("../models/seminar_detail_model"),seminar_title_model_1=require("../models/seminar_title_model"),seminar_model_1=require("../models/seminar_model"),seminar_period_model_1=require("../models/seminar_period_model"),registerSchema_1=__importDefault(require("../schemas/registerSchema")),bodyseminarregister_1=__importDefault(require("../schemas/bodyseminarregister")),bodyActivate_1=__importDefault(require("../schemas/bodyActivate")),bodycreatetitle_1=__importDefault(require("../schemas/bodycreatetitle")),bodytitleupdate_1=__importDefault(require("../schemas/bodytitleupdate")),query_string_titledelete_1=__importDefault(require("../schemas/query_string_titledelete")),bodyseminar_detail_1=__importDefault(require("../schemas/bodyseminar_detail")),bodysinginseminaruser_1=__importDefault(require("../schemas/bodysinginseminaruser")),md5=require("md5"),functions_helper_1=require("../utils/helpers/functions.helper"),validator_helper_1=require("../utils/helpers/validator.helper"),Validator=new validator_helper_1._Validator,Functions=new functions_helper_1._publicfunctions;function seminar($){return __awaiter(this,void 0,void 0,function(){var c,f,_,v,X,Z,t,r=this;return __generator(this,function(e){return new user_model_1.UserModel,new file_1.FileModel,c=new sd_users_narrator_model_1.SdusersNarratorModel,new sd_users_seminar_model_1.SdusersSeminarModel,f=new sd_users_seminar_model_1.SdusersSeminarModel,_=new seminar_detail_model_1.SeminarDetailModel,v=new seminar_title_model_1.SeminarTitleModel,X=new seminar_model_1.SeminarModels,new seminar_period_model_1.SeminarPeriodModel,Z=$.db,require("fastify-multer"),t=path.join(__dirname,"../../.env"),require("dotenv").config({path:t}),t=require("../../package.json"),t.port,t=process.env,t.API_KEY,$.post("/singup",{schema:registerSchema_1.default},function(h,g){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n,o,i,l,d,u,c,_,m,p;return __generator(this,function(e){switch(e.label){case 0:return g.header("Access-Control-Allow-Origin","*"),g.header("Access-Control-Allow-Methods","POST"),h.headers,t=h.body,Functions.getRandomchar(16),r=t.firstname,a=t.lastname,s=t.fullname,n=t.phonenumber,o=t.email,i=new Date,i=Functions.timeConvertermas(i),t.status,t.date,l=t.active||0,t.activedate,d=t.password,Date.now(),Date.now(),!1===(u=Functions.isemailValid(o))?(g.code(401).send({response:{message:"Email format checker failed, Please change email!",status:0,StatusCode:"401"}}),[2]):[4,f.validation_email(Z,o)];case 1:if(0<e.sent().length)return g.code(401).send({response:{message:"Email Duplicate , Please change email",status:0,StatusCode:"200"}}),[2];if(console.log("email",o),!1===Functions.passwordValidator(d))return g.code(401).send({response:{message:"Password checker failed!",status:0,StatusCode:"401"}}),[2];c=crypto.createHash("md5").update(d).digest("hex"),e.label=2;case 2:return e.trys.push([2,5,6,7]),(_={}).firstname=r,_.lastname=a,_.fullname=s,_.phonenumber=n,_.email=o,_.create=i,_.active=l,_.activedate=t.activedate,_.password=c,_.password_temp=d,[4,f.create_data(Z,_)];case 3:return e.sent(),[4,f.last_seminar_id(Z)];case 4:return _=e.sent(),p=_[0],console.log("luser",p),p=p.seminar_id,console.log("idx",p),(m=[]).seminar_id=p,m.email=u,m.firstname=r,m.lastname=a,m.create=i,p=$.jwt.sign({createsignin:m},{expiresIn:"1d"}),g.code(201).send({response:{message:"Register successful",status:1,token:p,StatusCode:"201"}}),[2];case 5:return e.sent(),g.code(401).send({response:{result:"Error",message:"Register Unsuccessful!",status:1,token:null,StatusCode:"401"}}),[2];case 6:return g.code(403).send({response:{result:"Error",message:"Sign up Unsuccessful ,Error System something!",status:1,token:null,StatusCode:"403"}}),[2];case 7:return[2]}})})}),$.post("/singin",{schema:bodysinginseminaruser_1.default},function(o,i){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n;return __generator(this,function(e){switch(e.label){case 0:return i.header("Access-Control-Allow-Origin","*"),i.header("Access-Control-Allow-Methods","POST"),r=o.body,t=r.email,r=r.password,console.log("email=>",t),console.log("password=>",r),a=crypto.createHash("md5").update(r).digest("hex"),[4,f.login(Z,t,a)];case 1:return n=e.sent(),console.log("email=>"+t),console.log("password=>"+r),console.log("encPassword=>"+a),console.log("rs=>"+n),0<n.length?(n=n[0],console.log("user=>",n),(s=[]).seminar_id=n.seminar_id,s.email=n.email,s.firstname=n.firstname,s.lastname=n.lastname,console.warn("rss=>",s),Date.now(),(new Date).getTime(),n=$.jwt.sign({seminar_id:s.seminar_id,email:s.email,firstname:s.firstname,lastname:s.lastname},{expiresIn:"1d"}),i.code(200).send({response:{message:"Create token Successful!",status:1,ok:!0,statusCode:"200",data:{seminar_id:s.seminar_id,email:s.email,firstname:s.firstname,lastname:s.lastname},token:n}})):i.code(401).send({response:{message:"Login failed!",status:1,ok:!1,statusCode:"401",data:null,token:null}}),[2]}})})}),$.post("/verifytoken",{preValidation:[$.authenticate]},function(o,i){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n;return __generator(this,function(e){return t=o.headers,o.body,t.host,t.secret_key,t=o.headers.authorization,t=t.replace("Bearer ",""),t=$.jwt.verify(t),n=t.iat,r=t.exp,Date.now(),s=(new Date).getTime(),Math.round(s/1e3),s=new Date(1e3*n),n=new Date(1e3*r),r=Functions.toEnDate(s),a=Functions.toEnDate(n),s=Functions.toThaiDate(s),n=Functions.toThaiDate(n),console.warn("start_date_en ",r),console.warn("end_date_en ",a),console.warn("start_date_thai ",s),console.warn("end_date_thai ",n),i.code(200).send({response:{message:"Authenticate verify token successful!",status:1,data:t,start_date_en:r,end_date_en:a,start_date_thai:s,end_date_thai:n,StatusCode:"200"}}),[2]})})}),$.post("/activate",{schema:bodyActivate_1.default},function(o,i){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n;return __generator(this,function(e){switch(e.label){case 0:return(i.header("Access-Control-Allow-Origin","*"),i.header("Access-Control-Allow-Methods","POST"),o.headers,s=o.body,null===(s=s.code))?(i.code(401).send({response:{message:"Please input code to activate account!",status:0,StatusCode:"401"}}),[2]):(s=$.jwt.verify(s),n=s.iat,t=s.exp,s.data,Date.now(),a=(new Date).getTime(),Math.round(a/1e3),a=new Date(1e3*n),n=new Date(1e3*t),t=Functions.toEnDate(a),r=Functions.toEnDate(n),a=Functions.toThaiDate(a),n=Functions.toThaiDate(n),console.warn("start_date_en=>",t),console.warn("end_date_en=>",r),console.warn("start_date_thai=>",a),console.warn("end_date_thai=>",n),console.warn("tokendecode=>",s),console.warn("count=> ",s.lengt),r=(t=s).createsignin.seminar_id,a=t.createsignin.email,n=new Date,s=Functions.timeConvertermas(n),n={status:1,active:1,activedate:s},console.log("inputupdate",n),[4,f.activate(Z,r,n)]);case 1:e.sent();try{return i.code(200).send({response:{message:"Activate successful!",status:1,StatusCode:"200",email:a,data:t}}),[2]}catch(e){return i.code(401).send({response:{result:"Error",message:"Activate error!",status:1,token:null,StatusCode:"401"}}),[2]}finally{return i.code(403).send({response:{result:"Error",message:"Activate ,Error System something!",status:1,token:null,StatusCode:"403"}}),[2]}return[2]}})})}),$.post("/registereminar",{preValidation:[$.authenticate],schema:bodyseminarregister_1.default},function(d,u){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n,o,i,l;return __generator(this,function(e){switch(e.label){case 0:return(u.header("Access-Control-Allow-Origin","*"),u.header("Access-Control-Allow-Methods","POST"),d.headers,l=d.body,Functions.getRandomchar(16),t=new Date,r=Functions.timeConvertermas(t),console.warn("datetime=> ",r),null===(r=l.seminar_title_id))?(u.code(401).send({response:{message:"Error seminar_title_id is null please input seminar_title_id!",status:0,StatusCode:"401"}}),[2]):(l.active_datatime,a=l.status_active||1,null===(s=l.period_id)?(u.code(401).send({response:{message:"Error period_id is null please input period_id!",status:0,StatusCode:"401"}}),[2]):(Date.now(),Date.now(),l=d.headers.authorization,l=l.replace("Bearer ",""),l=$.jwt.verify(l),(0,l).iat,l.exp,l.data,console.warn("tokendecode=>",l),console.warn("count=> ",l.lengt),n=l.seminar_id,l.email,0,[4,X.check_validate(Z,r,n,s)]));case 1:if(0<e.sent().length)return u.code(401).send({response:{message:"Register Duplicate , Please change seminar seminar_title_id and seminar_id and period_id",status:0,StatusCode:"200"}}),[2];e.label=2;case 2:return e.trys.push([2,5,6,7]),(o={}).seminar_title_id=r,o.datetime=Functions.timeConvertermas(t),o.period_id=s,o.seminar_id=n,o.status_active=a,[4,X.seminar_register(Z,o)];case 3:return i=e.sent(),[4,c.last_id(Z)];case 4:return l=e.sent(),u.code(201).send({response:{message:"Register datainput",status:1,data:o,rs:i,idxs:l,StatusCode:"201"}}),[2];case 5:return e.sent(),u.code(401).send({response:{result:"Error",message:"Register Unsuccessful!",status:1,token:null,StatusCode:"401"}}),[2];case 6:return u.code(403).send({response:{result:"Error",message:"Sign up Unsuccessful ,Error System something!",status:1,token:null,StatusCode:"403"}}),[2];case 7:return[2]}})})}),$.get("/usersseminarlist",function(Q,W){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n,o,i,l,d,u,c,_,m,p,h,g,f,v,w,y,C,b,S,O,A,T,D,E,N,B,U,I,K,V,z,H,G,k,P,L,F,q,M,Y,J,x,j,R;return __generator(this,function(e){switch(e.label){case 0:W.header("Access-Control-Allow-Origin","*"),W.header("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),e.label=1;case 1:return e.trys.push([1,8,,9]),c=Q.query,c.active_datatime,t=c.status_active||null,r=c.period_id,a=c.keyword,s=c.seminar_id,n=c.title_id,c.email,o=c.start,i=c.end,c.isCount,l=c.orderBy||"desc",c.limit,d=c.status||1,u=Number(null==c?void 0:c.page)||1,c=Number(null==c?void 0:c.perpage)||20,(_={}).seminar_id=s||null,_.title_id=n||null,_.period_id=r||null,_.status_active=t||null,_.status=d||1,_.keyword=a||null,_.isCount=1,[4,X.filter_title_users_seminar(Z,_)];case 2:return(_=e.sent(),console.log("getCount",_),0==(m=_.length))?(W.code(200).send({response:{message:"Result,Data is null!",error:"OK",StatusCode:"200",total_page:0,total:m,page:u,perpage:c,data:null}}),[2]):(p=Math.round(m/c)||1,console.log("total_pages=",p),(w={}).seminar_id=s||null,w.title_id=n||null,w.period_id=r||null,w.status_active=t||null,w.status=d||1,w.keyword=a||null,w.start=o||null,w.end=i||null,w.order=l||null,w.pages=u||1,w.sizepsge=c||10,w.isCount=0,[4,X.filter_title_users_seminar(Z,w)]);case 3:h=e.sent(),g=[],f=0,v=Object.entries(h),e.label=4;case 4:return f<v.length?(w=v[f],k=w[0],w[1],y=h[k].seminar_id,C=h[k].title_id,b=h[k].title_name,S=h[k].title,O=h[k].location,A=h[k].province,T=h[k].spake_time,D=h[k].title_url,E=Functions.timeConvertermas(h[k].startdate),N=Functions.timeConvertermas(h[k].enddate),B=h[k].narrator_firstname,U=h[k].narrator_lastname,I=h[k].fullname_narrator,K=h[k].narrator_email,V=h[k].firstname_seminar,z=h[k].lastname_seminar,H=h[k].phonenumber_seminar,G=h[k].email_seminar,k=h[k].fullname_semina,(j={}).title_id=C||null,[4,X.seminar_detail(Z,j)]):[3,7];case 5:for(P=e.sent(),L=[],F=0,q=Object.entries(P);F<q.length;F++)M=q[F],x=M[0],M[1],M=P[x].idx,Y=P[x].detail_name,J=Functions.timeConvertermas(P[x].startdate),x=Functions.timeConvertermas(P[x].enddate),L.push({idx:M,detail_name:Y,startdate:J,enddate:x});j={seminar_id:y,title_id:C,title_name:b,title:S,location:O,province:A,spake_time:T,url:D,startdate:E,enddate:N,narrator:I,fullname_narrator:B+" "+U,narrator_email:K,fullname_seminar:z+" "+V,phonenumber_seminar:H,email_seminar:G,fullname_semina:k},g.push(j),e.label=6;case 6:return f++,[3,4];case 7:return R=g,W.code(200).send({response:{message:"Result,Data successful!",error:"OK",StatusCode:"200",total_page:p,total:m,page:u,perpage:c,data:R}}),[2];case 8:return R=e.sent(),$.log.error("err=>",R),R?$.log.error(R):W.code(500).send({response:{message:"Eror Result!",error:R,StatusCode:"500",total_page:0,total:0,page:0,perpage:0,data:null}}),[2];case 9:return[2]}})})}),$.post("/usersseminarlist",{preValidation:[$.authenticate]},function(Q,W){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n,o,i,l,d,u,c,_,m,p,h,g,f,v,w,y,C,b,S,O,A,T,D,E,N,B,U,I,K,V,z,H,G,k,P,L,F,q,M,Y,J,x,j,R;return __generator(this,function(e){switch(e.label){case 0:W.header("Access-Control-Allow-Origin","*"),W.header("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),e.label=1;case 1:return e.trys.push([1,8,,9]),r=Q.headers,c=Q.query,Q.params,d=Q.body,t=Q.headers.authorization,t=t.replace("Bearer ",""),t=$.jwt.verify(t),console.warn("token_bearer ",t),t.iat,t.exp,r.host,r.secret_key,d.active_datatime,t=d.status_active||null,r=d.period_id,a=d.keyword,s=d.seminar_id,n=d.title_id,d.email,o=d.start,i=d.end,d.isCount,l=d.orderBy||"desc",d.limit,d=d.status||1,u=Number(null==c?void 0:c.page)||1,c=Number(null==c?void 0:c.perpage)||10,(_={}).seminar_id=s||null,_.title_id=n||null,_.period_id=r||null,_.status_active=t||null,_.status=d||1,_.keyword=a||null,_.isCount=1,[4,X.filter_title_users_seminar(Z,_)];case 2:return(_=e.sent(),console.log("getCount",_),0==(m=_.length))?(W.code(200).send({response:{message:"Result,Data is null!",error:"OK",StatusCode:"200",total_page:0,total:m,page:u,perpage:c,data:null}}),[2]):(p=Math.round(m/c)||1,console.log("total_pages=",p),(w={}).seminar_id=s||null,w.title_id=n||null,w.period_id=r||null,w.status_active=t||null,w.status=d||1,w.keyword=a||null,w.start=o||null,w.end=i||null,w.order=l||null,w.pages=u||1,w.sizepsge=c||50,w.isCount=0,[4,X.filter_title_users_seminar(Z,w)]);case 3:h=e.sent(),g=[],f=0,v=Object.entries(h),e.label=4;case 4:return f<v.length?(w=v[f],k=w[0],w[1],y=h[k].seminar_id,C=h[k].title_id,b=h[k].title_name,S=h[k].title,O=h[k].location,A=h[k].province,T=h[k].spake_time,D=h[k].title_url,E=Functions.timeConvertermas(h[k].startdate),N=Functions.timeConvertermas(h[k].enddate),B=h[k].narrator_firstname,U=h[k].narrator_lastname,I=h[k].fullname_narrator,K=h[k].narrator_email,V=h[k].firstname_seminar,z=h[k].lastname_seminar,H=h[k].phonenumber_seminar,G=h[k].email_seminar,k=h[k].fullname_semina,(j={}).title_id=C||null,[4,X.seminar_detail(Z,j)]):[3,7];case 5:for(P=e.sent(),L=[],F=0,q=Object.entries(P);F<q.length;F++)M=q[F],x=M[0],M[1],M=P[x].idx,Y=P[x].detail_name,J=Functions.timeConvertermas(P[x].startdate),x=Functions.timeConvertermas(P[x].enddate),L.push({idx:M,detail_name:Y,startdate:J,enddate:x});j={seminar_id:y,title_id:C,title_name:b,title:S,location:O,province:A,spake_time:T,url:D,startdate:E,enddate:N,narrator:I,fullname_narrator:B+" "+U,narrator_email:K,fullname_seminar:z+" "+V,phonenumber_seminar:H,email_seminar:G,fullname_semina:k},g.push(j),e.label=6;case 6:return f++,[3,4];case 7:return R=g,W.code(200).send({response:{message:"Result,Data successful!",error:"OK",StatusCode:"200",total_page:p,total:m,page:u,perpage:c,data:R}}),[2];case 8:return R=e.sent(),$.log.error("err=>",R),R?$.log.error(R):W.code(500).send({response:{message:"Eror Result!",error:R,StatusCode:"500",total_page:0,total:0,page:0,perpage:0,data:null}}),[2];case 9:return[2]}})})}),$.get("/titlelist",function(K,V){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n,o,i,l,d,u,c,_,m,p,h,g,f,v,w,y,C,b,S,O,A,T,D,N,B,E,k,P,F,q,M,U,I,x,j,R;return __generator(this,function(e){switch(e.label){case 0:V.header("Access-Control-Allow-Origin","*"),V.header("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),e.label=1;case 1:return e.trys.push([1,8,,9]),h=K.query,h.active_datatime,t=h.status_active||null,r=h.period_id,a=h.keyword,s=h.seminar_id,n=h.title_id,o=h.narrator_id,i=h.location,l=h.province,d=h.telephone,h.email,u=h.start,c=h.end,h.isCount,_=h.orderBy||"desc",h.limit,m=h.status||1,p=Number(null==h?void 0:h.page)||1,h=Number(null==h?void 0:h.perpage)||20,(g={}).seminar_id=s||null,g.title_id=n||null,g.period_id=r||null,g.status_active=t||null,g.status=m||1,g.keyword=a||null,g.narrator_id=o||null,g.location=i||null,g.province=l||null,g.telephone=d||null,g.isCount=1,[4,X.filter_title(Z,g)];case 2:return(g=e.sent(),console.log("getCount",g),0==(f=g.length))?(V.code(200).send({response:{message:"Result,Data is null!",error:"OK",StatusCode:"200",total_page:0,total:f,page:p,perpage:h,data:null}}),[2]):(v=Math.round(f/h)||1,console.log("total_pages=",v),(S={}).seminar_id=s||null,S.title_id=n||null,S.period_id=r||null,S.status_active=t||null,S.status=m||1,S.keyword=a||null,S.narrator_id=o||null,S.location=i||null,S.province=l||null,S.telephone=d||null,S.start=u||null,S.end=c||null,S.order=_||null,S.pages=p||null,S.perpage=h||20,S.isCount=0,[4,X.filter_title(Z,S)]);case 3:w=e.sent(),y=[],C=0,b=Object.entries(w),e.label=4;case 4:return C<b.length?(S=b[C],E=S[0],S[1],O=w[E].idx,A=w[E].title,T=w[E].firstname,D=w[E].lastname,w[E].fullname,N=w[E].date,B=Functions.timeConvertermas(w[E].start),E=Functions.timeConvertermas(w[E].end),(j={}).title_id=O||null,[4,X.seminar_detail(Z,j)]):[3,7];case 5:for(k=e.sent(),P=[],F=0,q=Object.entries(k);F<q.length;F++)M=q[F],x=M[0],M[1],M=k[x].idx,U=k[x].detail_name,I=Functions.timeConvertermas(k[x].startdate),x=Functions.timeConvertermas(k[x].enddate),P.push({idx:M,detail_name:U,startdate:I,enddate:x});j={title_id:O,title:A,full_name_narrator:T+" "+D,start:B,end:E,date:Functions.timeConvertermas(N),detail:P},y.push(j),e.label=6;case 6:return C++,[3,4];case 7:return R=y,V.code(200).send({response:{message:"Result,Data successful!",error:"OK",StatusCode:"200",total_page:v,total:f,page:p,perpage:h,data:R}}),[2];case 8:return R=e.sent(),$.log.error("err=>",R),R?$.log.error(R):V.code(500).send({response:{message:"Eror Result!",error:R,StatusCode:"500",total_page:0,total:0,page:0,perpage:0,data:null}}),[2];case 9:return[2]}})})}),$.post("/createtitle",{preValidation:[$.authenticate],schema:bodycreatetitle_1.default},function(p,h){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n,o,i,l,d,u,c,_,m;return __generator(this,function(e){switch(e.label){case 0:h.header("Access-Control-Allow-Origin","*"),h.header("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),e.label=1;case 1:return e.trys.push([1,4,,5]),t=p.headers,p.query,p.params,_=p.body,r=p.headers.authorization,r=r.replace("Bearer ",""),r=$.jwt.verify(r),console.warn("token_bearer ",r),r.iat,r.exp,t.host,t.secret_key,r=new Date,t=Functions.timeConvertermas(r),r=_.title,a=_.narrator_id,s=_.datetime_start,n=_.datetime_end,o=_.url,i=_.detail,l=_.spake_time,d=_.location,u=_.province,c=_.telephone,_=_.email,[4,v.check_email(Z,_)];case 2:return e.sent(),(m={}).title=r||null,m.narrator_id=a||null,m.create=t,m.datetime_start=s||null,m.datetime_end=n||null,m.url=o||null,m.detail=i||null,m.spake_time=l||null,m.location=d||null,m.province=u||null,m.telephone=c||null,m.email=_||null,[4,v.create_data(Z,m)];case 3:return e.sent(),h.code(200).send({response:{message:"Create date successful!",error:"OK",StatusCode:"200",data:null}}),[2];case 4:return m=e.sent(),$.log.error("err=>",m),m?$.log.error(m):h.code(500).send({response:{message:"Eror Result!",error:m,StatusCode:"500",data:null}}),[2];case 5:return[2]}})})}),$.post("/updatetitle",{preValidation:[$.authenticate],schema:bodytitleupdate_1.default},function(h,g){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n,o,i,l,d,u,c,_,m,p;return __generator(this,function(e){switch(e.label){case 0:g.header("Access-Control-Allow-Origin","*"),g.header("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),e.label=1;case 1:return e.trys.push([1,4,,5]),t=h.headers,h.query,h.params,m=h.body,r=h.headers.authorization,r=r.replace("Bearer ",""),r=$.jwt.verify(r),console.warn("token_bearer ",r),r.iat,r.exp,t.host,t.secret_key,r=new Date,t=Functions.timeConvertermas(r),r=m.id,a=m.title,s=m.narrator_id,n=m.datetime_start,o=m.datetime_end,i=m.url,l=m.detail,d=m.spake_time,u=m.location,c=m.province,_=m.telephone,m=m.email,[4,v.check_email(Z,m)];case 2:return e.sent(),(p={}).title=a,p.narrator_id=s,p.create=t,p.datetime_start=n,p.datetime_end=o,p.url=i,p.detail=l,p.spake_time=d,p.location=u,p.province=c,p.telephone=_,p.email=m,[4,v.update_by_id(Z,r,p)];case 3:return e.sent(),g.code(200).send({response:{message:"Create date successful!",error:"OK",StatusCode:"200",data:null}}),[2];case 4:return p=e.sent(),$.log.error("err=>",p),p?$.log.error(p):g.code(500).send({response:{message:"Eror Result!",error:p,StatusCode:"500",data:null}}),[2];case 5:return[2]}})})}),$.get("/deletetitle",{preValidation:[$.authenticate],schema:query_string_titledelete_1.default},function(s,n){return __awaiter(r,void 0,void 0,function(){var t,r,a;return __generator(this,function(e){switch(e.label){case 0:n.header("Access-Control-Allow-Origin","*"),n.header("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),e.label=1;case 1:return e.trys.push([1,4,,5]),r=s.headers,t=s.query,s.params,s.body,a=s.headers.authorization,a=a.replace("Bearer ",""),a=$.jwt.verify(a),console.warn("token_bearer ",a),a.iat,a.exp,r.host,r.secret_key,a=new Date,Functions.timeConvertermas(a),r=t.id,[4,v.check_data_by_id(Z,r)];case 2:return 0==e.sent().length?(n.code(401).send({response:{message:"id not found",status:0,StatusCode:"200"}}),[2]):[4,v.remove_by_id(Z,r)];case 3:return e.sent(),n.code(200).send({response:{message:"Delete date successful!",error:"OK",StatusCode:"200",data:null}}),[2];case 4:return a=e.sent(),$.log.error("err=>",a),a?$.log.error(a):n.code(500).send({response:{message:"Eror Result!",error:a,StatusCode:"500",data:null}}),[2];case 5:return[2]}})})}),$.post("/createseminardetail",{preValidation:[$.authenticate],schema:bodyseminar_detail_1.default},function(d,u){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n,o,i,l;return __generator(this,function(e){switch(e.label){case 0:u.header("Access-Control-Allow-Origin","*"),u.header("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),e.label=1;case 1:return e.trys.push([1,3,,4]),l=d.headers,d.query,d.params,o=d.body,s=d.headers.authorization,s=s.replace("Bearer ",""),s=$.jwt.verify(s),console.warn("token_bearer ",s),s.iat,s.exp,l.host,l.secret_key,s=new Date,l=o.seminar_title_id,t=o.title,r=o.detail,a=Functions.timeConvertermas(s),s=Functions.timeConvertermas(s),n=o.startdate,o=o.enddate,(i={}).seminar_title_id=l,i.title=t,i.detail=r,i.cteate=a,i.datetime=s,i.startdate=n||null,i.enddate=o||null,[4,_.create_data(Z,i)];case 2:return e.sent(),u.code(200).send({response:{message:"Create date successful!",error:"OK",StatusCode:"200",data:null}}),[2];case 3:return l=e.sent(),$.log.error("err=>",l),l?$.log.error(l):u.code(500).send({response:{message:"Eror Result!",error:l,StatusCode:"500",data:null}}),[2];case 4:return[2]}})})}),$.post("/updateseminardetail",{preValidation:[$.authenticate],schema:bodyseminar_detail_1.default},function(u,c){return __awaiter(r,void 0,void 0,function(){var t,r,a,s,n,o,i,l,d;return __generator(this,function(e){switch(e.label){case 0:c.header("Access-Control-Allow-Origin","*"),c.header("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),e.label=1;case 1:return e.trys.push([1,3,,4]),t=u.headers,u.query,u.params,i=u.body,n=u.headers.authorization,n=n.replace("Bearer ",""),n=$.jwt.verify(n),console.warn("token_bearer ",n),n.iat,n.exp,t.host,t.secret_key,n=new Date,t=i.id,d=i.seminar_title_id,r=i.title,a=i.detail,s=Functions.timeConvertermas(n),n=Functions.timeConvertermas(n),o=i.startdate,i=i.enddate,(l={}).id=t,l.seminar_title_id=d,l.title=r,l.detail=a,l.cteate=s,l.datetime=n,l.startdate=o||null,l.enddate=i||null,[4,_.update_by_id(Z,t,l)];case 2:return e.sent(),c.code(200).send({response:{message:"Update date successful!",error:"OK",StatusCode:"200",data:null}}),[2];case 3:return d=e.sent(),$.log.error("err=>",d),d?$.log.error(d):c.code(500).send({response:{message:"Eror Result!",error:d,StatusCode:"500",data:null}}),[2];case 4:return[2]}})})}),$.get("/deleteseminardetail",{preValidation:[$.authenticate],schema:query_string_titledelete_1.default},function(s,n){return __awaiter(r,void 0,void 0,function(){var t,r,a;return __generator(this,function(e){switch(e.label){case 0:n.header("Access-Control-Allow-Origin","*"),n.header("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),e.label=1;case 1:return e.trys.push([1,4,,5]),r=s.headers,t=s.query,s.params,s.body,a=s.headers.authorization,a=a.replace("Bearer ",""),a=$.jwt.verify(a),console.warn("token_bearer ",a),a.iat,a.exp,r.host,r.secret_key,a=new Date,Functions.timeConvertermas(a),r=t.id,[4,_.check_data_by_id(Z,r)];case 2:return 0==e.sent().length?(n.code(401).send({response:{message:"Id not found",status:0,StatusCode:"200"}}),[2]):[4,_.remove_by_id(Z,r)];case 3:return e.sent(),n.code(200).send({response:{message:"Delete date successful!",error:"OK",StatusCode:"200",data:null}}),[2];case 4:return a=e.sent(),$.log.error("err=>",a),a?$.log.error(a):n.code(500).send({response:{message:"Eror Result!",error:a,StatusCode:"500",data:null}}),[2];case 5:return[2]}})})}),[2]})})}exports.default=seminar;