"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const http_errors_1 = tslib_1.__importDefault(require("http-errors"));
const configurations_1 = require("../../configurations");
exports.default = {
    validateAllowedMethods: {
        event: 'onRequest',
        handler: function (routeOptions, route) {
            return function (request) {
                return tslib_1.__awaiter(this, void 0, void 0, function* () {
                    const allowedMethods = configurations_1.getAllowedMethods(this.config);
                    const handlerKey = Object.keys(routeOptions).find((key) => routeOptions[key].method === request.routerMethod &&
                        routeOptions[key].url === request.routerPath.replace(route || '/', ''));
                    if (handlerKey && !allowedMethods.includes(handlerKey)) {
                        throw http_errors_1.default(405, `Method ${request.routerMethod} is not allowed here`);
                    }
                });
            };
        }
    }
};
